<!DOCTYPE html>

<html lang="en-us">

<head>
  <meta charset="UTF-8">
  <title>Android Codelab by Vatsal Bajpai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
</head>

<body>
  <section class="page-header">
    <h1 class="project-name">Android Codelab</h1>
    <h2 class="project-tagline">Beginners Guide</h2>
    <a href="https://github.com/Vatsal-Bajpai/Android-Codelab" class="btn">View on GitHub</a>
    <a href="https://github.com/Vatsal-Bajpai/Android-Codelab/zipball/master" class="btn">Download .zip</a>
    <a href="https://github.com/Vatsal-Bajpai/Android-Codelab/tarball/master" class="btn">Download .tar.gz</a>
  </section>

  <section class="main-content">
    <h1>
      <a id="building-a-chat-application-for-android" class="anchor" href="#building-a-chat-application-for-android" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>Setting up Android : </h1>

    <table>
      <thead>
        <tr>
          <th align="center">
            <strong>Summary</strong>
          </th>
          <th align="center">In this codelab, you'll learn how to set up Android Studio and get started to build applications.</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td align="center">
            <strong>URL</strong>
          </td>
          <td align="center"><a href="https://github.com/Vatsal-Bajpai/Android-Codelab">https://github.com/Vatsal-Bajpai/Android-Codelab</a></td>
        </tr>
        <tr>
          <td align="center">
            <strong>Category</strong>
          </td>
          <td align="center">Beginners Guide</td>
        </tr>
        <tr>
          <td align="center">
            <strong>Feedback Link</strong>
          </td>
          <td align="center">You can provide feedback on the content bundle and codelab here.</td>
        </tr>
      </tbody>
    </table>

    <h2>
      <a id="content" class="anchor" href="#content" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>Content</h2>

    <ul>
      <li>Overview</li>
      <li>What you will learn</li>
      <li>What you will need</li>
      <li>Installing Java</li>
      <li>Installing Android Studio</li>
      <li>Building First Application</li>
      <li>Allow the user to send a message</li>
      <li>Show the (existing and new) messages</li>
      <li>Enable login</li>
      <li>Wrap-up</li>
      <li>What we've covered</li>
      <li>Next Steps</li>
      <li>Learn More</li>
    </ul>

    <h3>
      <a id="overview" class="anchor" href="#overview" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>Overview - </h3>

    <p>In this codelab you’ll set up Android Studio and build a basic application.</p>

    <h3>
      <a id="what-youll-learn" class="anchor" href="#what-youll-learn" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>What you will learn - </h3>

    <ul>
      <li>Setting up Java and Installing Android Studio.
        <br>
      </li>
      <li>Building basic Android application.</li>
    </ul>

    <h3>
      <a id="what-youll-need" class="anchor" href="#what-youll-need" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>What you will need - </h3>

    <ul>
      <li>
        <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java Development Kit</a> current version 8u60.</li>
      <li>
        <a href="https://developer.android.com/sdk/installing/studio.html">Android Studio</a> version 2.0+.</li>
      <li>A test device or emulator with Android 4.0+ (preferred 5.0+).</li>
      <li>The device must have internet access to download SDK components.</li>
    </ul>

    <h2>
      <a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true">
        <span class="octicon octicon-link"></span>
      </a>Getting Started - </h3>

      <h3>
        <a id="installing-java" class="anchor" href="#installing-java" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Installing Java - </h3>

      <p>In this step we will set up Java Environment.
        <br /> 1. Download JDK from this link (<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a>) or the latest version available
        and install.
        <br /> 2. Open your C: drive &gt; Program Files and search Java folder and open it.
        <br /> 3. Open folder (like jdk1.7.0_40) depending on your jdk version &gt; bin folder.
        <br /> 4. Search for file Javac, right click &gt; properties and copy file path(eg. C:\Program Files\Java\jdk1.7.0_40\bin).
        <br /> 5. Goto start My computer &gt; right click &gt; properties.
        <br /> 6. Click Advance system settings on the left bar.
        <br /> 7. Click Environment Variables &gt; New button.
        <br /> 8. For the Variable name, type : Path.
        <br /> 9. For Variable value, paste the Javac location path you copied.
        <br />
        <div class="separator" style="clear: both; text-align: center;">
          <a href="http://1.bp.blogspot.com/-INLrv2vtO1g/VPxCsXEQrUI/AAAAAAAAADI/GLviB-ijCsQ/s1600/javasdk.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
            <img border="0" height="400" src="http://1.bp.blogspot.com/-INLrv2vtO1g/VPxCsXEQrUI/AAAAAAAAADI/GLviB-ijCsQ/s1600/javasdk.PNG" width="371" />
          </a>
        </div>
        <br />
        <br /> 10. Click Ok and close all popups and close settings.
        <br /> 11. To check if it is setup, Open command promt and type javac, if you see java source files then you are all set to go!&nbsp;
      </p>

      <h3>
        <a id="installing-android-studio" class="anchor" href="#installing-android-studio" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Installing Android Studio - </h3>

      <p>In this step we will install Android Studio and setup SDK Manager.
        <br /> 1. You need to download Android Studio from this link(<a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>).
        <br /> 2. While installing the setup you can install the Android SDK updates at the time of installation or later manually.
        <br /> 3. Open Android Studio &gt; Tools &gt; Android &gt; Android SDK and open it.
        <br />
        <div class="separator" style="clear: both; text-align: center;">
          <a href="http://3.bp.blogspot.com/-qiN2kGVKSEE/VPxFACtYEAI/AAAAAAAAADU/gH4m1Rv2bxQ/s1600/sdk.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
            <img border="0" height="214" src="http://3.bp.blogspot.com/-qiN2kGVKSEE/VPxFACtYEAI/AAAAAAAAADU/gH4m1Rv2bxQ/s1600/sdk.png" width="320" />
          </a>
        </div>
        <br />
        <br /> 4. Download and Install the latest updates(It will automatically select for you).

      </p>

      <h3>
        <a id="connect-the-android-project-to-firebase" class="anchor" href="#connect-the-android-project-to-firebase" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Building First Application - </h3>

      <br /> 1. Start Android Studio.
      <br /> 2. In the main window select Start a new Android Studio project.
      <br /> 3. Type the name of the app you want (Android Codelab GDG).
      <br /> 4. Change your Company Domain (You can't use default to upload apps to playstore).
      <br /> 5. Choose your project location.
      <br /> 6. Select next &gt; next (we will use Blank Activity for now) &gt; Finish.
      <br /> 7. Now to Run the app either choose Run 'app' from menu bar.
      <br /> 8. You will see this popup either Use a device( <a href="http://appyware.blogspot.in/2015/03/enable-usb-debugging.html" target="_blank"> Follow this link to learn )</a> or Create AVD( <a href="http://appyware.blogspot.in/2015/03/create-android-virtual-device.html"
      target="_blank">Follow this link to learn</a> ). Select the choice and press OK.
      <br />
      <br /> To replace your name instead of Hello World! text :
      <br /> 1. In your activity_main.xml and in the text part of the code browse to TextView and android:text="@string/hello_world". Replace this line by android:text="Your name".
      <pre>
        <code> android:text="Android Codelab "
        </code>
      </pre>

      <h3>
        <a id="allow-the-user-to-send-a-message" class="anchor" href="#allow-the-user-to-send-a-message" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Allow the user to send a message</h3>

      <p>Duration: 0:20</p>

      <p>Now we can start sending data to Firebase! In this step we’ll allow the user to enter a message in a text box. When they then click the Send button, we will send the message to Firebase.</p>

      <ul>
        <li>We’ll first add the necessary views to activity_main.xml:</li>
      </ul>

      <pre>
        <code> &lt;LinearLayout android:id="@+id/footer" android:layout_alignParentBottom="true" android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal"&gt; &lt;EditText android:id="@+id/message_text" android:layout_width="0dp"
          android:layout_weight="1" android:layout_height="wrap_content" android:singleLine="true" android:inputType="textShortMessage" /&gt; &lt;Button android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Send" /&gt;
          &lt;/LinearLayout&gt;
        </code>
      </pre>

      <p>Now we have an EditText, where the user can enter their chat message, and a Button that they can click to send the message.</p>

      <ul>
        <li>In our MainActivity.java we’ll now add a member field for the EditText:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-smi">EditText</span> mEditText;</pre>
      </div>

      <p>and initialize it at the end of the onCreate method:</p>

      <div class="highlight highlight-java">
        <pre> mMessageEditText
          <span class="pl-k">=</span> (
          <span class="pl-smi">EditText</span>)
          <span class="pl-v">this</span>
          <span class="pl-k">.</span>findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>message_text);</pre>
      </div>

      <ul>
        <li>Next, we’ll add a method that grabs the text from the input and send it to our Firebase database:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span> onSendButtonClick(
          <span class="pl-smi">View</span> v) {
          <span class="pl-smi">String</span> message
          <span class="pl-k">=</span> mMessageEdit
          <span class="pl-k">.</span>getText()
          <span class="pl-k">.</span>toString();
          <span class="pl-k">Map&lt;
            <span class="pl-smi">String</span>,
            <span class="pl-smi">Object</span>&gt;</span> values
          <span class="pl-k">=</span>
          <span class="pl-k">new</span>
          <span class="pl-k">HashMap&lt;&gt;</span>(); values
          <span class="pl-k">.</span>put(
          <span class="pl-s">
            <span class="pl-pds">"</span>name
            <span class="pl-pds">"</span>
          </span>,
          <span class="pl-s">
            <span class="pl-pds">"</span>puf
            <span class="pl-pds">"</span>
          </span>); values
          <span class="pl-k">.</span>put(
          <span class="pl-s">
            <span class="pl-pds">"</span>message
            <span class="pl-pds">"</span>
          </span>, message); mFirebaseRef
          <span class="pl-k">.</span>push()
          <span class="pl-k">.</span>setValue(values); mMessageEdit
          <span class="pl-k">.</span>setText(
          <span class="pl-s">
            <span class="pl-pds">"</span>
            <span class="pl-pds">"</span>
          </span>); }
        </pre>
      </div>

      <p>You will have to import the packages for some of these classes. Android Studio will tell you where to import them from.</p>

      <ul>
        <li>
          <p>Here we grab the message from the EditText, add it to a Map, and send it off to Firebase. We’ll look at a way to replace that Map with something more type-safe in the next section, but for now this will work. Also note that we hard-coded our
            user name for the moment. We’ll use Firebase Authentication to make this dynamic in the last section of this code lab.</p>
        </li>
        <li>
          <p>Now we'll wire up the onSendButtonClick method to the button in main_acitivity.xml by adding this attribute to the button:</p>
        </li>
      </ul>

      <pre>
        <code> android:onClick="onSendButtonClick"
        </code>
      </pre>

      <ul>
        <li>
          <p>If you now run the application in the emulator, you will see an input field with a Send button that sends the message to Firebase. Open the URL of your Firebase database, and you’ll see it light up green as you add new messages.</p>
        </li>
        <li>
          <p>Open the Data tab in the Firebase Dashboard of your app. You’ll see it light up green as you add new messages. Admit it, this is pretty cool!</p>
        </li>
      </ul>

      <p>Now that we can send messages to Firebase, it is time for the next step: making the messages show up in our Android app in realtime.</p>

      <h3>
        <a id="show-the-existing-and-new-messages" class="anchor" href="#show-the-existing-and-new-messages" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Show the (existing and new) messages</h3>

      <p>Duration: 0:20</p>

      <p>A chat app that doesn’t show existing messages is not very useful. So in this step we’ll add a list of the existing messages to our Android app. At the end of this section we’ll have a fully functional chat app.</p>

      <p>Let's take this in chunks: first you'll build a new layout that we use to display each message, then you'll create a Java class to represent each message and finally we'll get the message from Firebase and put them into a ListView.</p>

      <ul>
        <li>
          <p>Each chat message has the same layout. So we’ll create a new layout XML file for the messages.</p>
        </li>
        <li>
          <p>Create a new layout file message_layout.xml</p>
        </li>
        <li>
          <p>in the layout XML, change the orientation of the LinearLayout to horizontal, so the we can have the user name on the left and the message on the right of it.</p>
        </li>
      </ul>

      <pre>
        <code> &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="match_parent"&gt;
        </code>
      </pre>

      <ul>
        <li>add two TextView controls to the layout: one for the username and one for the chat message:</li>
      </ul>

      <pre>
        <code> &lt;TextView android:id="@+id/username_text_view" android:text="Username" android:textStyle="bold" android:gravity="end" android:layout_width="0dp" android:layout_weight="3" android:layout_height="wrap_content" android:padding="10dp"/&gt; &lt;TextView
          android:id="@+id/message_text_view" android:text="Message" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="10" android:paddingLeft="0dp" android:paddingRight="10dp" android:paddingTop="10dp" android:paddingBottom="10dp"/&gt;
        </code>
      </pre>

      <p>Most of these attributes are just there to make the messages look reasonable. So feel free to use your own padding and layout attributes. Just be sure to use the same R.id fields in your code that you specify in the android:id attributes in the
        XML.
      </p>

      <ul>
        <li>Now create a class ChatMessage.java that wraps the username and text message:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">public</span>
          <span class="pl-k">class</span>
          <span class="pl-en">ChatMessage</span> {
          <span class="pl-k">private</span>
          <span class="pl-smi">String</span> name;
          <span class="pl-k">private</span>
          <span class="pl-smi">String</span> message;

          <span class="pl-k">public</span>
          <span class="pl-en">ChatMessage</span>() {
          <span class="pl-c">// necessary for Firebase's deserializer</span>
          }
          <span class="pl-k">public</span>
          <span class="pl-en">ChatMessage</span>(
          <span class="pl-smi">String</span>
          <span class="pl-v">name</span>,
          <span class="pl-smi">String</span>
          <span class="pl-v">message</span>) {
          <span class="pl-v">this</span>
          <span class="pl-k">.</span>name
          <span class="pl-k">=</span> name;
          <span class="pl-v">this</span>
          <span class="pl-k">.</span>message
          <span class="pl-k">=</span> message; }

          <span class="pl-k">public</span>
          <span class="pl-smi">String</span>
          <span class="pl-en">getName</span>() {
          <span class="pl-k">return</span> name; }

          <span class="pl-k">public</span>
          <span class="pl-smi">String</span>
          <span class="pl-en">getMessage</span>() {
          <span class="pl-k">return</span> message; } }
        </pre>
      </div>

      <p>As you can see, this is plain-old Java object. But it’s a POJO with some special traits. First ChatMessage follows a JavaBean pattern for its property names. The getName method is a getter for a name property, while getMessage is a getter for a
        message property. And second, those property names correspond to the ones we’ve been using when we sent messages to Firebase in our onSendButtonClick() function.</p>

      <p>If you end up making this ChatMessage an inner class of another class, you must make it static: public static class ChatMessage.</p>

      <ul>
        <li>
          <p>With the layout for the message specified and their structure defined in a class, now you need to make a space for them in the main_activity.xml</p>
        </li>
        <li>
          <p>Add a ListView with android:id="<a href="https://github.com/android" class="user-mention">@android</a>:id/list" above the LinearLayout:</p>
        </li>
      </ul>

      <pre>
        <code> &lt;ListView android:id="@android:id/list" android:layout_width="match_parent" android:layout_height="match_parent" android:layout_above="@+id/footer"/&gt;
        </code>
      </pre>

      <p>This is the container that all messages will be added to: one message_layout for each ChatMessage.
        <br> The id value is very important here, since Android uses it to find the ListView. So make sure to enter it exactly as specified: <a href="https://github.com/android" class="user-mention">@android</a>:id/list.</p>

      <ul>
        <li>
          <p>Now download FirebaseListAdapter.java from <a href="https://github.com/rohanraarora/Firebase-Codelab/blob/master/app/src/main/java/com/gdgnd/firebasecodelab/FirebaseListAdapter.java">https://github.com/rohanraarora/Firebase-Codelab/blob/master/app/src/main/java/com/gdgnd/firebasecodelab/FirebaseListAdapter.java</a>            and add it to your project. The FirebaseListAdapter class adapts a Firebase collection so that it becomes usable in an Android ListView. To add it to your app, add a new file to your application called FirebaseListAdapter and copy the Java
            code from the link above into that file. Don't forget to change the package name in the first line to match your project.</p>
        </li>
        <li>
          <p>Make the MainActivity class descend from ListActivity. This is a built-in Android base-class. By deriving from this, our activity will automatically have access to the ListView we added to the layout:</p>
        </li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">public</span>
          <span class="pl-k">class</span>
          <span class="pl-en">MainActivity</span>
          <span class="pl-k">extends</span>
          <span class="pl-e">ListActivity</span> {</pre>
      </div>

      <ul>
        <li>Now we'll make everything come together, by adding this to the onCreate method of our MainActivity:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre> mListAdapter
          <span class="pl-k">=</span>
          <span class="pl-k">new</span>
          <span class="pl-k">FirebaseListAdapter&lt;
            <span class="pl-smi">ChatMessage</span>&gt;</span>(mFirebaseRef,
          <span class="pl-smi">ChatMessage</span>
          <span class="pl-k">.</span>class,
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>layout
          <span class="pl-k">.</span>message_layout,
          <span class="pl-v">this</span>) {
          <span class="pl-k">@Override</span>
          <span class="pl-k">protected</span>
          <span class="pl-k">void</span>
          <span class="pl-en">populateView</span>(
          <span class="pl-smi">View</span>
          <span class="pl-v">v</span>,
          <span class="pl-smi">ChatMessage</span>
          <span class="pl-v">model</span>) { ((
          <span class="pl-smi">TextView</span>)v
          <span class="pl-k">.</span>findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>username_text_view))
          <span class="pl-k">.</span>setText(model
          <span class="pl-k">.</span>getName()); ((
          <span class="pl-smi">TextView</span>)v
          <span class="pl-k">.</span>findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>message_text_view))
          <span class="pl-k">.</span>setText(model
          <span class="pl-k">.</span>getMessage()); } }; setListAdapter(mListAdapter);
        </pre>
      </div>

      <p>The FirebaseListAdapter maps the data from your Firebase database into the ListView that you added to the layout. It creates a new instance of your message_layout for each ChatMessage and calls the populateView method. You override this method and
        put the name and message in the correct subviews.</p>

      <ul>
        <li>
          <p>Don't worry, the hardest part is behind us now. All that is left in this step is some clean-up. But before that, run your app and see that it shows all existing messages. And if you send a new message, it shows up in the emulator and in your
            Firebase dashboard.
          </p>
        </li>
        <li>
          <p>The cleanup is minor, but it's important to keep our code as readable as possible at all times. Remember that onSendButtonClick method that we wrote in step 5? That use of a Map looked a bit messy. Now that we have a ChatMessage class, we can
            make it much more readable:</p>
        </li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span> onSendButtonClick(
          <span class="pl-smi">View</span> v) {
          <span class="pl-smi">String</span> message
          <span class="pl-k">=</span> mMessageEdit
          <span class="pl-k">.</span>getText()
          <span class="pl-k">.</span>toString(); mFirebaseRef
          <span class="pl-k">.</span>push()
          <span class="pl-k">.</span>setValue(
          <span class="pl-k">new</span>
          <span class="pl-smi">ChatMessage</span>(
          <span class="pl-s">
            <span class="pl-pds">"</span>puf
            <span class="pl-pds">"</span>
          </span>, message)); mMessageEdit
          <span class="pl-k">.</span>setText(
          <span class="pl-s">
            <span class="pl-pds">"</span>
            <span class="pl-pds">"</span>
          </span>); }
        </pre>
      </div>

      <p>In this section we made our app show the chat messages. It was a lot of work, but in the end you can see that the Java code is not that big, Thanks to firebase.</p>

      <h3>
        <a id="enable-login" class="anchor" href="#enable-login" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Enable login</h3>

      <p>Duration: 0:15 As a final step, we're going to allow the users of our app to log in using email and password.</p>

      <ul>
        <li>First add a button to the top right of activity_main.xml</li>
      </ul>

      <pre>
        <code> &lt;Button android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Login" android:id="@+id/login" android:layout_alignParentTop="true" android:layout_alignParentEnd="true" android:onClick="onLoginButtonClick" /&gt;
        </code>
      </pre>

      <p>Note that the button refers to an onLoginButtonClick method, which you'll create in a few minutes.</p>

      <ul>
        <li>Now create a new layout called dialog_signin.xml, which we'll use to model the body of the sign-in dialog</li>
      </ul>

      <pre>
        <code> &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="vertical" android:layout_width="wrap_content" android:layout_height="wrap_content"&gt; &lt;EditText android:id="@+id/email" android:inputType="textEmailAddress"
          android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginTop="16dp" android:layout_marginLeft="4dp" android:layout_marginRight="4dp" android:layout_marginBottom="4dp" android:hint="Email" /&gt; &lt;EditText
          android:id="@+id/password" android:inputType="textPassword" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginTop="4dp" android:layout_marginLeft="4dp" android:layout_marginRight="4dp" android:layout_marginBottom="16dp"
          android:hint="Password"/&gt; &lt;/LinearLayout&gt;
        </code>
      </pre>

      <p>So we have two EditText controls under each other. The rest of the popup will be handled by a stock Android dialog. Since your app will display the sign-in dialog as a popup, add the handling to MainActivity.java:</p>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span> onLoginButtonClick(
          <span class="pl-smi">View</span> v) {
          <span class="pl-smi">AlertDialog</span>
          <span class="pl-k">.</span>
          <span class="pl-smi">Builder</span> builder
          <span class="pl-k">=</span>
          <span class="pl-k">new</span>
          <span class="pl-smi">AlertDialog</span>.
          <span class="pl-smi">Builder</span>(
          <span class="pl-v">this</span>); builder

          <span class="pl-k">.</span>setMessage(
          <span class="pl-s">
            <span class="pl-pds">"</span>Enter your email address and password
            <span class="pl-pds">"</span>
          </span>) .setTitle(
          <span class="pl-s">
            <span class="pl-pds">"</span>Log in
            <span class="pl-pds">"</span>
          </span>);

          <span class="pl-smi">LayoutInflater</span> inflater
          <span class="pl-k">=</span>
          <span class="pl-v">this</span>
          <span class="pl-k">.</span>getLayoutInflater(); builder
          <span class="pl-k">.</span>setView(inflater
          <span class="pl-k">.</span>inflate(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>layout
          <span class="pl-k">.</span>dialog_signin,
          <span class="pl-c1">null</span>)); builder

          <span class="pl-k">.</span>setPositiveButton(
          <span class="pl-s">
            <span class="pl-pds">"</span>OK
            <span class="pl-pds">"</span>
          </span>,
          <span class="pl-k">new</span>
          <span class="pl-smi">DialogInterface</span>.
          <span class="pl-smi">OnClickListener</span>() {
          <span class="pl-k">public</span>
          <span class="pl-k">void</span>
          <span class="pl-en">onClick</span>(
          <span class="pl-smi">DialogInterface</span>
          <span class="pl-v">dialog</span>,
          <span class="pl-k">int</span>
          <span class="pl-v">id</span>) {
          <span class="pl-smi">AlertDialog</span> dlg
          <span class="pl-k">=</span> (
          <span class="pl-smi">AlertDialog</span>) dialog;
          <span class="pl-k">final</span>
          <span class="pl-smi">String</span> email
          <span class="pl-k">=</span> ((
          <span class="pl-smi">TextView</span>)dlg
          <span class="pl-k">.</span>findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>email))
          <span class="pl-k">.</span>getText()
          <span class="pl-k">.</span>toString();
          <span class="pl-k">final</span>
          <span class="pl-smi">String</span> password
          <span class="pl-k">=</span>((
          <span class="pl-smi">TextView</span>)dlg
          <span class="pl-k">.</span>findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>password))
          <span class="pl-k">.</span>getText()
          <span class="pl-k">.</span>toString();

          <span class="pl-c">// TODO: sign in to Firebase</span>

          } }); builder
          <span class="pl-k">.</span>setNegativeButton(
          <span class="pl-s">
            <span class="pl-pds">"</span>Cancel
            <span class="pl-pds">"</span>
          </span>,
          <span class="pl-c1">null</span>);

          <span class="pl-smi">AlertDialog</span> dialog
          <span class="pl-k">=</span> builder
          <span class="pl-k">.</span>create(); dialog
          <span class="pl-k">.</span>show(); }
        </pre>
      </div>

      <p>This method builds and show the dialog, with our two text boxes as the main body. When the user clicks OK, it extracts the email address and password from the text controls.</p>

      <ul>
        <li>Now wire the values that we got from the dialog to the Firebase Authentication back-end. Replace the TODO with the following code:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre> mFirebaseRef
          <span class="pl-k">.</span>createUser(email, password,
          <span class="pl-k">new</span>
          <span class="pl-smi">Firebase</span>.
          <span class="pl-smi">ResultHandler</span>() {
          <span class="pl-k">@Override</span>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span>
          <span class="pl-en">onSuccess</span>() { mFirebaseRef
          <span class="pl-k">.</span>authWithPassword(email, password,
          <span class="pl-c1">null</span>); }
          <span class="pl-k">@Override</span>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span>
          <span class="pl-en">onError</span>(
          <span class="pl-smi">FirebaseError</span>
          <span class="pl-v">firebaseError</span>) { mFirebaseRef
          <span class="pl-k">.</span>authWithPassword(email, password,
          <span class="pl-c1">null</span>); } });
        </pre>
      </div>

      <p>In this code, we always try to register the user. If the user already registered that will result in onError, otherwise it will result on onSuccess.
        <br> Either way, we next call authWithPassword to authenticate the (pre-existing or just-created) user. </p>

      <ul>
        <li>
          <p>With the above we have the registration/login flow working. But we still need to listen to when Firebase Authentication tells us the user has been authenticated, so that we can store the username and use that in the chat message instead of the
            hard-coded value we have now.</p>
        </li>
        <li>
          <p>Add a field to the class to hold the user name:</p>
        </li>
      </ul>

      <div class="highlight highlight-java">
        <pre>
          <span class="pl-k">private</span>
          <span class="pl-smi">String</span> mUsername;</pre>
      </div>

      <ul>
        <li>Add the end of the onCreate method, add a callback method that listens for authentication state changes in Firebase:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre> mFirebaseRef
          <span class="pl-k">.</span>addAuthStateListener(
          <span class="pl-k">new</span>
          <span class="pl-smi">Firebase</span>.
          <span class="pl-smi">AuthStateListener</span>() {
          <span class="pl-k">@Override</span>
          <span class="pl-k">public</span>
          <span class="pl-k">void</span>
          <span class="pl-en">onAuthStateChanged</span>(
          <span class="pl-smi">AuthData</span>
          <span class="pl-v">authData</span>) {
          <span class="pl-k">if</span>(authData
          <span class="pl-k">!=</span>
          <span class="pl-c1">null</span>) { mUsername
          <span class="pl-k">=</span> ((
          <span class="pl-smi">String</span>)authData
          <span class="pl-k">.</span>getProviderData()
          <span class="pl-k">.</span>get(
          <span class="pl-s">
            <span class="pl-pds">"</span>email
            <span class="pl-pds">"</span>
          </span>)); findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>login)
          <span class="pl-k">.</span>setVisibility(
          <span class="pl-smi">View</span>
          <span class="pl-c1">
            <span class="pl-k">.</span>INVISIBLE</span>); }
          <span class="pl-k">else</span> { mUsername
          <span class="pl-k">=</span>
          <span class="pl-c1">null</span>; findViewById(
          <span class="pl-smi">R</span>
          <span class="pl-k">.</span>id
          <span class="pl-k">.</span>login)
          <span class="pl-k">.</span>setVisibility(
          <span class="pl-smi">View</span>
          <span class="pl-c1">
            <span class="pl-k">.</span>VISIBLE</span>); } } });
        </pre>
      </div>

      <p>Firebase calls our listener whenever the authentication state changes, so whenever the user logs in or out. When the user logs in, we store their email address in our field and hide the login button.</p>

      <p>Firebase Authentication supports multiple authentication providers and each of them exposes a different set of data. For example, if we'd allow our users to authenticate with their existing Twitter account, we could identify them by their twitter
        handle.
      </p>

      <ul>
        <li>Finally, replace the hard-coded username with the field we just populated:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre> mFirebaseRef
          <span class="pl-k">.</span>push()
          <span class="pl-k">.</span>setValue(
          <span class="pl-k">new</span>
          <span class="pl-smi">ChatMessage</span>(mUsername, message));</pre>
      </div>

      <p>We could definitely improve the layout of things. But this step has been long enough as it is. So let's wrap up with a few notes.</p>

      <ul>
        <li>One thing you may note is that the user stays logged in, even when they restart the app. If instead you want to sign out the user, you can call:</li>
      </ul>

      <div class="highlight highlight-java">
        <pre> mFirebaseRef
          <span class="pl-k">.</span>unauth();</pre>
      </div>

      <p>This will trigger the AuthStateListener we created before, which will clear the username field and re-enable the login button.</p>

      <ul>
        <li>If you want to know which users logged in to your application, you can find them in the Login &amp; Auth tab of your Firebase's dashboard.</li>
      </ul>

      <p>This is also where you can configure the password reset emails that you can send to your users, in case they forgot their password.</p>

      <h3>
        <a id="wrap-up" class="anchor" href="#wrap-up" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Wrap-up</h3>

      <p>Congratulations! You've just built a fully functional multi-user chat application that uses Firebase to store the data and authentication users.</p>

      <p>As a reward for finishing the codelab you’ve earned a promo code! When you’re ready to put your Firebase app in production, you can use the promo code
        <strong>androidcodelab49</strong> for $49 off your first month of a paid Firebase plan. Just enter the code when you upgrade your Firebase. </p>

      <h3>
        <a id="what-weve-covered" class="anchor" href="#what-weve-covered" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>What we've covered</h3>

      <p>✓ Interacting with a Firebase Database from an Android application.
        <br> ✓ Using Firebase Authentication in an Android application to authenticate users.</p>

      <h3>
        <a id="next-steps" class="anchor" href="#next-steps" aria-hidden="true">
          <span class="octicon octicon-link"></span>
        </a>Next Steps</h3>

      <ul>
        <li>Add a log-out button to the app</li>
        <li>Add a password-reset button to the login dialog</li>
        <li>Allow the user to specify a nickname or use one of the Firebase's social authentication providers to look up their first name.</li>
        <li>Get your app on the Play Store! Learn More</li>
        <li>Learn all about using <a href="https://www.firebase.com/docs/android/">Firebase with Android</a> by following the <a href="https://www.firebase.com/docs/android/guide/">Firebase for Android development guide</a>.</li>
        <li>Study a more advanced sample application: <a href="https://github.com/firebase/AndroidDrawing">AndroidDrawing</a>
        </li>
        <li>Learn about <a href="https://github.com/firebase/geofire-java">GeoFire</a> for Java, which allows you to add realtime location queries to your Android application</li>
      </ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/rohanraarora/Firebase-Codelab">Firebase Android Codelab</a> is maintained by <a href="https://github.com/rohanraarora">rohanraarora</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

  </section>


</body>

</html>
